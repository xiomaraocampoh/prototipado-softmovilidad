<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portal CUE - Movilidad</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@400;700&family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        /* CSS Clásico Oficial de la Institución */
        body {
            font-family: 'Lato', sans-serif;
            background-color: #ffffff;
            color: #777;
            margin: 0;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }
        .navbar-classic {
            font-family: 'Montserrat', sans-serif;
            background-color: #00529c;
            border: 0;
            letter-spacing: 4px;
            height: 60px;
            width: 100%;
            position: fixed;
            top: 0;
            z-index: 50;
            display: flex;
            align-items: center;
            padding: 0 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .container-classic {
            padding: 100px 15px 40px 15px;
            flex-grow: 1;
        }
        .title-classic {
            font-size: 45px;
            color: #111;
            margin-bottom: 40px;
            text-align: center;
            font-weight: bold;
        }
        @media (min-width: 768px) {
            .title-classic { font-size: 55px; }
        }
        .label-classic {
            font-size: 20px;
            color: #111;
            font-weight: 400;
            margin-bottom: 8px;
            display: block;
        }
        .input-classic {
            width: 100%;
            max-width: 300px;
            height: 34px;
            padding: 6px 12px;
            font-size: 14px;
            line-height: 1.42857143;
            color: #555;
            background-color: #fff;
            background-image: none;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-shadow: inset 0 1px 1px rgba(0,0,0,.075);
            transition: border-color ease-in-out .15s,box-shadow ease-in-out .15s;
            outline: none;
        }
        .input-classic:focus {
            border-color: #66afe9;
            box-shadow: inset 0 1px 1px rgba(0,0,0,.075), 0 0 8px rgba(102, 175, 233, .6);
        }
        .btn-primary-classic {
            color: #fff;
            background-color: #337ab7;
            border: 1px solid #2e6da4;
            padding: 10px 16px;
            font-size: 18px;
            line-height: 1.3333333;
            border-radius: 6px;
            width: 100%;
            max-width: 300px;
            cursor: pointer;
            margin-top: 15px;
        }
        .btn-primary-classic:hover {
            background-color: #286090;
            border-color: #204d74;
        }
        .btn-default-classic {
            color: #333;
            background-color: #fff;
            border: 1px solid #ccc;
            padding: 10px 16px;
            font-size: 18px;
            line-height: 1.3333333;
            border-radius: 6px;
            width: 100%;
            max-width: 300px;
            cursor: pointer;
            margin-top: 10px;
        }
        .btn-default-classic:hover {
            background-color: #e6e6e6;
            border-color: #adadad;
        }
        .footer-classic {
            background-color: #00529c;
            color: #f5f5f5;
            padding: 32px;
            text-align: center;
        }
        .footer-classic a {
            color: #f5f5f5;
            text-decoration: none;
            font-weight: bold;
        }
        .footer-classic a:hover {
            color: #777;
        }
        .footer-classic h5 {
            font-size: 14px;
            line-height: 1.8;
            margin: 0;
            font-weight: normal;
        }
    </style>
</head>
<body>

    <nav class="navbar-classic">
        <img src="assets/img/logo_avh.png" alt="Logo CUE" style="height: 40px; background: white; padding: 2px; border-radius: 4px;">
    </nav>

    <div class="container-classic mx-auto max-w-6xl">
        
        <div id="error-msg" class="hidden bg-[#f2dede] border border-[#ebccd1] text-[#a94442] p-3 rounded mb-4 text-center max-w-md mx-auto">
            <span id="error-text">Error</span>
        </div>

        <div class="w-full">
            
            <div class="title-classic" id="portalTitle">
                Portal CUE
            </div>

            <div class="flex flex-col md:flex-row items-center justify-center w-full gap-8 md:gap-0 mt-8">
                
                <div class="w-full md:w-1/2 flex justify-center items-center">
                    <img src="assets/img/logo_camara.png" alt="Logo Institucional" class="max-w-full w-[350px] h-auto" onerror="this.style.display='none'">
                </div>

                <div class="w-full md:w-1/2 flex justify-center md:justify-start md:pl-[10%]">
                    
                    <form id="portalStep1" class="w-full flex flex-col items-center md:items-start">
                        
                        <div class="mb-2 w-full">
                            <label class="label-classic" style="font-size: 16px; font-weight: bold;">Correo Institucional:</label>
                            <input type="email" id="portalEmail" required class="input-classic">
                        </div>

                        <div class="w-full max-w-[300px] mb-4">
                            <label class="flex items-center gap-2 text-sm text-[#777] cursor-pointer">
                                <input id="reuseLastCode" type="checkbox" class="w-4 h-4">
                                Usar último código generado
                            </label>
                        </div>

                        <button type="submit" class="btn-primary-classic">Ingresar</button>
                    </form>

                    <form id="portalStep2" class="w-full hidden flex flex-col items-center md:items-start">
                        
                        <label class="label-classic text-center md:text-left">
                            El código de seguridad se envió al correo <br> 
                            <strong id="portalEmailEcho" style="color: #337ab7;"></strong>
                        </label>
                        <br>
                        
                        <input name="CodigoToken" id="portalCode" type="password" size="25" maxlength="4" class="input-classic text-center tracking-[8px] text-lg" required/>
                        <br>
                        
                        <button type="submit" class="btn-primary-classic">Ingresar</button>
                        <button type="button" id="backToStep1" class="btn-default-classic">Volver</button>
                        
                    </form>

                </div>
            </div>
        </div>
    </div>

    <footer class="footer-classic">
        <h5>
            MiCUEonline v4.0<br>
            Desarrollado por: <a href="mailto:direccion-desarrolloysistemasdeinformacion@cue.edu.co">Departamento de Desarrollo y Sistemas de Información</a><br>
            Corporación Universitaria Empresarial "Alexander von Humboldt"<br>
            Personería Jurídica Resolución 439 de 14 de marzo de 2001 otorgada por MINEDUCACIÓN<br>
            I.E.S. sujeta a inspección y vigilancia por MINEDUCACIÓN<br>
            Armenia, 2026<br>
        </h5>
    </footer>

    <div class="fixed bottom-[100px] left-4 bg-white border border-gray-300 shadow-xl p-3 rounded opacity-10 hover:opacity-100 transition-opacity duration-300 z-50 max-w-[220px]">
        <p class="text-[10px] font-bold text-gray-500 uppercase tracking-wider mb-2 text-center">Modo Demo</p>
        <div class="grid grid-cols-2 gap-1.5">
            <button type="button" onclick="demoPortal('estudiante@cue.edu.co')" class="text-[10px] py-1 px-2 border border-gray-200 hover:bg-gray-50 text-gray-600 rounded">Estudiante</button>
            <button type="button" onclick="demoPortal('docente@cue.edu.co')" class="text-[10px] py-1 px-2 border border-gray-200 hover:bg-gray-50 text-gray-600 rounded">Profesor</button>
            <button type="button" onclick="demoPortal('administrativo@cue.edu.co')" class="text-[10px] py-1 px-2 border border-gray-200 hover:bg-gray-50 text-gray-600 rounded">Admin.</button>
            <button type="button" onclick="demoPortal('egresado@cue.edu.co')" class="text-[10px] py-1 px-2 border border-gray-200 hover:bg-gray-50 text-gray-600 rounded">Egresado</button>
            <button type="button" onclick="demoPortal('externo@unam.mx')" class="text-[10px] py-1 px-2 border border-gray-200 hover:bg-gray-50 text-gray-600 rounded">Externo</button>
            <button type="button" onclick="demoPortal('rector@cue.edu.co')" class="text-[10px] py-1 px-2 border border-gray-200 hover:bg-gray-50 text-gray-600 rounded">Rector</button>
        </div>
        <div class="mt-3 pt-2 border-t border-gray-200 text-center">
            <a href="index-sistema.html" class="text-[10px] text-[#337ab7] font-bold hover:underline">Ir a Acceso al Sistema</a>
        </div>
    </div>

    <script src="assets/js/auth.js"></script>
    <script>
        // Ocultar íconos de Lucide ya que no se usan en este diseño
        const errorBox = document.getElementById('error-msg');
        const errorText = document.getElementById('error-text');
        const portalTitle = document.getElementById('portalTitle');

        const step1 = document.getElementById('portalStep1');
        const step2 = document.getElementById('portalStep2');
        const portalEmail = document.getElementById('portalEmail');
        const reuseLastCode = document.getElementById('reuseLastCode');
        const portalEmailEcho = document.getElementById('portalEmailEcho');
        const portalCode = document.getElementById('portalCode');

        function showError(msg) {
            errorText.textContent = msg;
            errorBox.classList.remove('hidden');
        }
        function clearError() {
            errorBox.classList.add('hidden');
        }
        
        function showStep2(email) {
            portalTitle.innerHTML = '<b>Portal CUE: Validación</b>';
            portalEmailEcho.textContent = email;
            step1.classList.add('hidden');
            step2.classList.remove('hidden');
            portalCode.focus();
        }
        
        function showStep1() {
            portalTitle.innerHTML = '<b>Portal CUE</b>';
            step2.classList.add('hidden');
            step1.classList.remove('hidden');
        }

        step1.onsubmit = (e) => {
            e.preventDefault();
            clearError();

            const email = portalEmail.value;
            const res = AuthService.requestPortalCode(email, { reuseLast: reuseLastCode.checked });

            if (!res.success) return showError(res.message);
            showStep2(email);
            alert(`Código ${res.reused ? 'reutilizado' : 'enviado'} (simulación): ${res.code}`);
        };

        step2.onsubmit = (e) => {
            e.preventDefault();
            clearError();

            const email = portalEmail.value;

            // Validación de código y asignación automática de rol según correo
            const res = AuthService.loginPortal(email, portalCode.value);
            if (!res.success) return showError(res.message);

            // Redirigir al portal CUE (sidebar); desde ahí "Movilidad" lleva al dashboard del solicitante
            window.location.href = 'portal-cue.html';
        };

        document.getElementById('backToStep1').onclick = () => {
            clearError();
            showStep1();
        };

        window.demoPortal = (email) => {
            portalEmail.value = email;
            reuseLastCode.checked = false;
        };
    </script>
</body>
</html>