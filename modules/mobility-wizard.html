<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Radicar Movilidad - CUE</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../assets/css/style.css">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        .form-label { display: block; font-size: 0.75rem; font-weight: 700; color: #4b5563; margin-bottom: 0.25rem; text-transform: uppercase; }
        .form-input { width: 100%; padding: 0.5rem 0.75rem; border: 1px solid #d1d5db; border-radius: 0.375rem; outline: none; background: white; transition: all 0.2s; font-size: 0.875rem; }
        .form-input:focus { border-color: #0077b6; box-shadow: 0 0 0 3px rgba(0, 119, 182, 0.1); }
        .form-input[readonly] { background-color: #f3f4f6; cursor: not-allowed; color: #6b7280; }
        .step-indicator { transition: all 0.3s; }
        .step-indicator.active div { background-color: #03045e; color: white; border-color: #03045e; }
        .step-indicator.active span { color: #03045e; font-weight: 800; }
    </style>
</head>
<body class="bg-[#f0f4f8] text-[#1a1a1a] min-h-screen flex flex-col font-['Inter']">

    <nav class="bg-white border-b-4 border-[#03045e] shadow-md sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-6 h-16 flex justify-between items-center">
            <div class="flex items-center gap-4">
                <img src="../assets/img/logo_avh.png" alt="Logo CUE" class="h-10">
                <h1 class="font-bold text-[#03045e] text-lg border-l pl-4">Formulario de Movilidad (FO-IN-012)</h1>
            </div>
            <button onclick="window.location.href='dashboard-estudiante.html'" class="text-gray-400 hover:text-red-500 flex items-center gap-1 text-sm font-bold"><i data-lucide="x-circle" class="w-4 h-4"></i> Cancelar</button>
        </div>
    </nav>

    <main class="flex-grow container mx-auto px-4 py-8 max-w-5xl">
        
        <div class="mb-8 relative z-0">
            <div class="absolute top-5 left-0 w-full h-1 bg-gray-200 -z-10"></div>
            <div class="flex justify-between w-full">
                <div class="step-indicator active flex flex-col items-center w-1/4" data-step="1"><div class="w-10 h-10 bg-gray-300 text-gray-500 rounded-full flex items-center justify-center font-bold border-4 border-[#f0f4f8]">1</div><span class="text-xs text-gray-400 mt-1">Naturaleza</span></div>
                <div class="step-indicator flex flex-col items-center w-1/4" data-step="2"><div class="w-10 h-10 bg-gray-300 text-gray-500 rounded-full flex items-center justify-center font-bold border-4 border-[#f0f4f8]">2</div><span class="text-xs text-gray-400 mt-1">Logística</span></div>
                <div class="step-indicator flex flex-col items-center w-1/4" data-step="3"><div class="w-10 h-10 bg-gray-300 text-gray-500 rounded-full flex items-center justify-center font-bold border-4 border-[#f0f4f8]">3</div><span class="text-xs text-gray-400 mt-1">Datos y Finanzas</span></div>
                <div class="step-indicator flex flex-col items-center w-1/4" data-step="4"><div class="w-10 h-10 bg-gray-300 text-gray-500 rounded-full flex items-center justify-center font-bold border-4 border-[#f0f4f8]">4</div><span class="text-xs text-gray-400 mt-1">Documentos</span></div>
            </div>
        </div>

        <form id="mobilityForm" class="bg-white rounded-xl shadow-lg border border-gray-100" onsubmit="WizardLogic.submit(event)">
            
            <div class="p-8" id="step-1">
                <h2 class="text-xl font-bold text-[#03045e] border-b pb-3 mb-6">Paso 1: Naturaleza de la Movilidad</h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div><label class="form-label">Dirección</label><input type="text" id="mobilityDirection" class="form-input font-bold text-[#0077b6]" readonly></div>
                    <div><label class="form-label">Modalidad (Lugar)</label>
                        <select id="mobilityModality" class="form-input" onchange="WizardLogic.updateFields()"><option value="PRESENCIAL">Presencial</option><option value="VIRTUAL">Virtual</option></select>
                    </div>
                    <div><label class="form-label">Alcance Territorial</label>
                        <select id="mobilityScope" class="form-input" onchange="WizardLogic.updateFields()"><option value="NACIONAL">Nacional</option><option value="INTERNACIONAL">Internacional</option></select>
                    </div>
                    <div class="md:col-span-3 border-t pt-4">
                        <label class="form-label text-[#03045e]">Tipo Específico de Movilidad</label>
                        <select id="mobilityType" class="form-input md:w-1/2 border-[#0077b6] bg-blue-50" onchange="WizardLogic.updateFields()"></select>
                    </div>
                </div>
            </div>

            <div class="hidden p-8" id="step-2">
                <h2 class="text-xl font-bold text-[#03045e] border-b pb-3 mb-6">Paso 2: Institución y Cronograma</h2>

                <div id="origenContainer" class="hidden mb-6 bg-yellow-50 p-4 rounded border border-yellow-200">
                    <h3 class="font-bold text-yellow-800 text-sm mb-3"><i data-lucide="building" class="inline w-4 h-4"></i> Institución de Origen</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div><label class="form-label">Universidad / Entidad de Origen</label><input type="text" class="form-input"></div>
                        <div><label class="form-label">País de Origen</label><input type="text" class="form-input"></div>
                        <div class="md:col-span-2"><label class="form-label">Institución Destino</label><input type="text" class="form-input font-bold" value="CUE Alexander von Humboldt" readonly></div>
                    </div>
                </div>

<<div id="destinoContainer" class="hidden mb-6 bg-blue-50 p-4 rounded border border-blue-200">
                    <h3 class="font-bold text-[#0077b6] text-sm mb-3"><i data-lucide="map-pin" class="inline w-4 h-4"></i> Información de Destino</h3>
                    
                    <div id="destinoSearchContainer" class="mb-4">
                        <label class="form-label">Institución en Convenio (Obligatorio)</label>
                        <select id="entity_select" class="form-input cursor-pointer border-[#0077b6]" onchange="WizardLogic.checkOtherEntity()">
                            </select>
                    </div>
                    
                    <div id="destinoLibreContainer" class="hidden mb-4">
                        <label class="form-label text-orange-600">Nombre de la Institución, Entidad o Empresa</label>
                        <input type="text" id="other_entity_name" class="form-input border-orange-200" placeholder="Escriba el nombre oficial del lugar de destino...">
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="form-label">País Destino</label>
                            <input type="text" id="field_country" class="form-input transition-colors" placeholder="Ej: México">
                        </div>
                        <div>
                            <label class="form-label">Ciudad Destino</label>
                            <input type="text" id="field_city" class="form-input transition-colors" placeholder="Ej: Ciudad de México">
                        </div>
                    </div>

                    <div id="extraFieldsContainer" class="hidden mt-4 pt-4 border-t border-blue-200">
                        <div id="researchFields" class="hidden"><label class="form-label text-purple-700">Nombre del Proyecto de Investigación</label><input type="text" class="form-input"></div>
                        <div id="eventFields" class="hidden"><label class="form-label text-purple-700">Nombre del Evento / Congreso</label><input type="text" class="form-input"></div>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6 bg-gray-50 p-4 border rounded">
                    <div class="md:col-span-4 font-bold text-xs text-[#03045e] uppercase border-b pb-1 mb-2">Cronograma</div>
                    <div><label class="form-label">Inicio Académico</label><input type="date" id="fechaInicio" class="form-input" onchange="WizardLogic.calculateDuration()"></div>
                    <div><label class="form-label">Fin Académico</label><input type="date" id="fechaFin" class="form-input" onchange="WizardLogic.calculateDuration()"></div>
                    <div class="md:col-span-2"><label class="form-label">Duración Calculada</label><input type="text" id="duracionCalculada" class="form-input font-bold" readonly placeholder="Automático"></div>
                    
                    <div class="req-presencial"><label class="form-label text-orange-600">Fecha Ida (Viaje)</label><input type="date" class="form-input border-orange-200"></div>
                    <div class="req-presencial"><label class="form-label text-orange-600">Fecha Regreso</label><input type="date" class="form-input border-orange-200"></div>
                    <div class="md:col-span-2 req-presencial"><label class="form-label">Dir. Residencia (Destino)</label><input type="text" class="form-input" placeholder="Lugar donde se hospedará"></div>
                </div>

                <div id="transportContainer" class="hidden border-t pt-4">
                    <label class="flex items-center gap-2 text-sm font-bold text-[#03045e] mb-4 cursor-pointer">
                        <input type="checkbox" id="hiredTransport" class="w-4 h-4 accent-[#03045e]" onchange="WizardLogic.updateFields()"> Se contratará Transporte Terrestre (Activa Requisitos SST)
                    </label>
                    <div id="vehicleDetails" class="hidden grid grid-cols-1 md:grid-cols-3 gap-4 bg-orange-50 p-4 rounded border border-orange-200">
                        <div class="md:col-span-3 text-xs text-orange-800 font-bold mb-2">Deberá subir SOAT, Tecnomecánica y Pólizas en el Paso 4.</div>
                        <input type="text" placeholder="Empresa Transporte" class="form-input"><input type="text" placeholder="Placa" class="form-input"><input type="text" placeholder="Licencia Conductor" class="form-input">
                    </div>
                </div>
            </div>

            <div class="hidden p-8" id="step-3">
                <h2 class="text-xl font-bold text-[#03045e] border-b pb-3 mb-6">Paso 3: Detalles Académicos y Financieros</h2>

                <div class="bg-green-50 p-4 rounded border border-green-200 mb-6">
                    <h3 class="font-bold text-green-800 text-sm mb-4"><i data-lucide="circle-dollar-sign" class="inline w-4 h-4"></i> Información Financiera</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="form-label">¿Genera costo de matrícula/participación?</label>
                            <select id="hasCosto" class="form-input mb-2" onchange="WizardLogic.toggleFinance()"><option value="NO">NO</option><option value="SI">SÍ</option></select>
                            <input type="number" id="montoCosto" placeholder="¿Cuánto? (Valor COP/USD)" class="form-input hidden">
                        </div>
                        <div>
                            <label class="form-label">¿Tuvo apoyo o beca institucional/externa?</label>
                            <select id="hasBeca" class="form-input mb-2" onchange="WizardLogic.toggleFinance()"><option value="NO">NO</option><option value="SI">SÍ</option></select>
                            <input type="number" id="montoBeca" placeholder="¿Cuánto? (Valor COP/USD)" class="form-input hidden">
                        </div>
                    </div>
                </div>

                <div id="studentPersonalData">
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                        <div class="md:col-span-4 font-bold text-xs text-gray-500 uppercase border-b pb-1">Perfil Académico</div>
                        <div><label class="form-label">Documento</label><input type="text" id="autoDoc" class="form-input bg-gray-100" readonly></div>
                        <div class="md:col-span-2"><label class="form-label">Programa</label>
                            <select class="form-input"><option>Ing. Software</option><option>Derecho</option><option>Medicina</option></select>
                        </div>
                        <div><label class="form-label">Semestre</label><input type="number" id="autoSem" class="form-input"></div>
                        <div><label class="form-label">Promedio</label><input type="number" step="0.1" id="autoProm" class="form-input"></div>
                    </div>
                    
                    <div class="req-presencial border-t pt-4">
                        <h3 class="font-bold text-red-600 text-sm mb-4 uppercase"><i data-lucide="heart-pulse" class="inline w-4 h-4"></i> Riesgos y Emergencia (SST)</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                            <div><label class="form-label">EPS / Seguro Médico</label><input type="text" class="form-input"></div>
                            <div><label class="form-label">Necesidades Médicas / Medicamentos Control</label><input type="text" class="form-input" placeholder="Alergias, condiciones..."></div>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 bg-gray-50 p-4 rounded border">
                            <div class="md:col-span-3 font-bold text-xs text-gray-500 uppercase border-b pb-1">Contacto Emergencia</div>
                            <input type="text" placeholder="Nombre Completo" class="form-input"><input type="text" placeholder="Parentesco" class="form-input"><input type="tel" placeholder="Teléfono" class="form-input">
                        </div>
                    </div>
                </div>

                <div id="professorRosterData" class="hidden border-t pt-4">
                    <h3 class="font-bold text-[#0077b6] text-sm mb-4"><i data-lucide="users" class="inline w-4 h-4"></i> Listado de Estudiantes (Participantes)</h3>
                    <div class="bg-blue-50 p-4 rounded border border-blue-100 text-sm text-blue-800 text-center italic">
                        [Área de selección de estudiantes simulada para el prototipo]
                    </div>
                </div>
            </div>

            <div class="hidden p-8" id="step-4">
                <h2 class="text-xl font-bold text-[#03045e] border-b pb-3 mb-2">Paso 4: Repositorio Documental Específico</h2>
                <p class="text-xs text-gray-500 mb-6 bg-yellow-50 p-2 border border-yellow-200 rounded">La lista de documentos se ha generado dinámicamente según la modalidad, alcance y tipo de movilidad seleccionados.</p>
                
                <div id="docsList" class="space-y-3 mb-8"></div>
                
                <div class="p-4 bg-blue-50 border border-[#0077b6] rounded flex gap-3">
                    <input type="checkbox" id="termsCheck" class="mt-1 w-5 h-5 accent-[#03045e]">
                    <label for="termsCheck" class="text-xs text-[#03045e]"><strong>Consentimiento Legal:</strong> Acepto términos y condiciones. Autorizo el tratamiento de mis datos personales y médicos según la política institucional (Acuerdo 001 de 2017).</label>
                </div>
            </div>

            <div class="bg-gray-50 px-8 py-4 flex justify-between items-center rounded-b-xl border-t">
                <button type="button" id="prevBtn" class="px-6 py-2 border bg-white rounded font-bold text-gray-600 hidden" onclick="WizardLogic.step(-1)">Anterior</button>
                <div class="flex-1 flex justify-center"><button type="button" onclick="WizardLogic.save()" class="text-sm font-bold text-gray-500 hover:text-[#0077b6] flex items-center gap-1"><i data-lucide="save" class="w-4 h-4"></i> Guardar Borrador</button></div> 
                <button type="button" id="nextBtn" class="px-6 py-2 bg-[#0077b6] text-white rounded font-bold hover:bg-[#03045e]" onclick="WizardLogic.step(1)">Siguiente <i data-lucide="arrow-right" class="w-4 h-4 inline"></i></button>
                <button type="submit" id="submitBtn" class="px-8 py-2 bg-[#03045e] text-white rounded font-bold hover:bg-black hidden shadow-lg">RADICAR FO-IN-012 <i data-lucide="check" class="w-4 h-4 inline"></i></button>
            </div>
        </form>
    </main>

    <script src="../assets/js/auth.js"></script>
    <script src="../assets/js/wizard-logic.js"></script>
</body>
</html>