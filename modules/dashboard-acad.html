<script>
    // SCRIPT DE AUTO-REPARACIÓN PARA DEMO
    // Si entras y no ves nada, esto crea una solicitud falsa para que pruebes.
    document.addEventListener('DOMContentLoaded', () => {
        // Verificar si hay solicitudes en memoria
        const requests = JSON.parse(localStorage.getItem('MOBILITY_REQUESTS') || '[]');
        
        if (requests.length === 0) {
            console.log("Modo Demo: Creando solicitud de prueba...");
            const demoRequest = {
                id: 'REQ-DEMO-001',
                studentName: 'Estudiante Demo',
                program: 'Ingeniería de Software',
                destination: 'UNAM (México)',
                status: 'EN_REVISION_ACADEMICA', // Estado correcto para que lo vea el coordinador
                average: '4.5'
            };
            localStorage.setItem('MOBILITY_REQUESTS', JSON.stringify([demoRequest]));
            location.reload(); // Recargar para mostrarla
        } else {
            // Renderizar datos reales
            renderTable(requests);
        }
    });

    function renderTable(data) {
        const tbody = document.querySelector('tbody');
        tbody.innerHTML = ''; // Limpiar
        
        // Filtrar solo lo que le corresponde al coordinador
        const myTasks = data.filter(r => r.status === 'EN_REVISION_ACADEMICA');

        if (myTasks.length === 0) {
            tbody.innerHTML = '<tr><td colspan="5" class="p-4 text-center text-gray-500">No hay solicitudes pendientes en su bandeja.</td></tr>';
            return;
        }

        myTasks.forEach(req => {
            const row = `
                <tr class="hover:bg-gray-50 border-b border-gray-100">
                    <td class="p-4">
                        <div class="font-bold text-[#0077b6]">${req.studentName}</div>
                        <div class="text-xs text-gray-400">${req.id}</div>
                    </td>
                    <td class="p-4 text-sm">${req.program}</td>
                    <td class="p-4 text-sm">${req.destination}</td>
                    <td class="p-4">
                        <span class="text-xs bg-green-100 text-green-700 px-2 py-1 rounded">Promedio OK</span>
                    </td>
                    <td class="p-4">
                        <button onclick="approve('${req.id}')" class="bg-[#03045e] text-white px-3 py-1 rounded text-xs hover:bg-blue-800">Avalar</button>
                    </td>
                </tr>
            `;
            tbody.innerHTML += row;
        });
    }

    window.approve = function(id) {
        if(confirm('¿Avalar académicamente esta solicitud?')) {
            // Actualizar estado en "Base de Datos" (LocalStorage)
            const requests = JSON.parse(localStorage.getItem('MOBILITY_REQUESTS'));
            const index = requests.findIndex(r => r.id === id);
            if (index !== -1) {
                requests[index].status = 'EN_REVISION_FINANCIERA'; // Avanzar al siguiente paso
                localStorage.setItem('MOBILITY_REQUESTS', JSON.stringify(requests));
                alert('Solicitud avalada. Enviada a Financiera.');
                location.reload();
            }
        }
    };
</script>